<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticación con Google</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
    <h1>Autenticación con Google Calendar</h1>
    <p>Inicia sesión con tu cuenta de Google para poder agendar citas en tu calendario.</p>

    <button id="google-sign-in-btn">Iniciar sesión con Google</button>

    <div id="status"></div>

    <script>
        // Configura el cliente OAuth
        const CLIENT_ID = 'TU_GOOGLE_CLIENT_ID';  // Sustituye por tu CLIENT_ID
        const API_KEY = 'TU_GOOGLE_API_KEY';    // Sustituye por tu API_KEY
        const SCOPES = 'https://www.googleapis.com/auth/calendar';

        // Cargar la API de Google
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Inicializar la API cliente de Google
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES,
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]
            }).then(function () {
                // Cuando se carga el cliente, se configura el botón de inicio de sesión
                document.getElementById('google-sign-in-btn').addEventListener('click', signIn);
            });
        }

        // Función de inicio de sesión
        function signIn() {
            gapi.auth2.getAuthInstance().signIn().then(function (googleUser) {
                const profile = googleUser.getBasicProfile();
                const authResponse = googleUser.getAuthResponse();
                const refreshToken = authResponse.refresh_token;  // Obtén el refresh token

                // Mostrar el estado
                document.getElementById('status').innerHTML = `
                    <p>¡Bienvenido, ${profile.getName()}!</p>
                    <p>Tu correo: ${profile.getEmail()}</p>
                    <p>Refresh Token: ${refreshToken}</p>
                `;

                // Aquí podrías hacer una llamada a tu API para guardar el refresh token
                // y usarlo para interactuar con el calendario.
                console.log('Refresh Token:', refreshToken);
            }).catch(function (error) {
                document.getElementById('status').innerHTML = `<p>Error al iniciar sesión: ${error.error}</p>`;
            });
        }

        // Iniciar la carga del cliente cuando se cargue la página
        handleClientLoad();
    </script>
</body>
</html>
